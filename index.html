<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="language" content="Arabic" />
    <meta name="geo.region" content="EG" />
    <meta name="geo.placename" content="Egypt" />
    <title>Roma & Knzy Store</title>
    <link rel="icon" type="image/png" href="1.png" />
    <meta name="description" content="موقع روما و كنزي Roma & Knzy Stor يقدم خدمات شحن و شراء متابعين انستجرام وأيضاً خدمات تيك توك بأرخص الأسعار وبجودة عالية." />
    <meta name="keywords" content="شحن متابعين انستجرام, شراء متابعين انستجرام, متابعين انستجرام, لايكات تيك توك, مشاهدات تيك توك, حفظ تيك توك, شير تيك توك" />
    <meta name="author" content="Roma & Knzy Team" />
    <meta property="og:title" content="Roma&knzy stor | شحن متابعين انستجرام وخدمات تيك توك بأرخص الأسعار" />
    <meta property="og:description" content="أفضل موقع لشحن وشراء متابعين إنستجرام وخدمات تيك توك (لايكات، مشاهدات، حفظ، شير) بأرخص الأسعار - Roma & Knzy Stor." />
    <meta property="og:url" content="https://maryamhamed27277-hash.github.io/Roma-knzy-stor/" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="ar_AR" />
    <link rel="canonical" href="https://maryamhamed27277-hash.github.io/Roma-knzy-stor/" />

    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        /* Base */
        * { box-sizing: border-box; margin:0; padding:0; font-family:'Tajawal',sans-serif; }
        :root{
            --primary:#E91E63; --primary-dark:#C2185B; --accent:#FF80AB; --bg-dark:#1A1A2E; --light:#FCE4EC;
            --tiktok-pink:#FE2C55; --tiktok-blue:#25F4EE;
        }
        body{ background:linear-gradient(135deg,var(--bg-dark) 0%, #2D1B3E 100%); color:var(--light); min-height:100vh; line-height:1.6; overflow-x:hidden; }

        .container{ max-width:1200px; margin:0 auto; padding:20px; }

        /* Header */
        header{ display:flex; justify-content:space-between; align-items:center; gap:15px; padding:15px; background:rgba(0,0,0,0.45); border-radius:12px; margin-bottom:20px; backdrop-filter: blur(6px); }
        .logo-container{ display:flex; gap:12px; align-items:center; }
        .logo img{ width:48px; height:48px; border-radius:50%; object-fit:cover; box-shadow:0 6px 18px rgba(0,0,0,0.5); }
        .logo-text{ font-size:20px; font-weight:800; background:linear-gradient(135deg,#ff4b91,#ff4ba2); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

        nav{ display:flex; gap:12px; align-items:center; }
        nav a{ color:var(--light); text-decoration:none; padding:8px 14px; border-radius:20px; transition:0.25s; font-weight:600; }
        nav a:hover{ background:rgba(255,255,255,0.06); transform:translateY(-2px); }

        .menu-toggle{ display:none; background:none; border:none; color:var(--light); font-size:22px; cursor:pointer; }

        /* Service Tabs */
        .service-tabs{ display:flex; gap:14px; justify-content:center; margin:18px 0; }
        .service-tab{ padding:12px 22px; border-radius:25px; background:rgba(255,255,255,0.04); cursor:pointer; border:1px solid rgba(255,255,255,0.06); font-weight:700; transition:0.25s; }
        .service-tab.active{ background: linear-gradient(135deg,var(--primary),var(--accent)); box-shadow:0 10px 30px rgba(233,30,99,0.18); color:#fff; transform:translateY(-6px); }
        .service-tab.tiktok.active{ background: linear-gradient(135deg,var(--tiktok-pink),var(--tiktok-blue)); }

        /* Hero */
        .hero{ text-align:center; padding:60px 15px; position:relative; border-radius:12px; background: rgba(255,255,255,0.02); margin-bottom:18px; }
        .hero h1{ font-size:2.6rem; margin-bottom:12px; background:linear-gradient(to right,var(--accent),#ff9ad6); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .hero p{ font-size:1.1rem; opacity:0.9; margin-bottom:18px; }

        .btn{ display:inline-block; background:linear-gradient(135deg,var(--primary),var(--accent)); color:white; padding:12px 26px; border-radius:30px; text-decoration:none; font-weight:800; box-shadow:0 8px 24px rgba(233,30,99,0.18); border:none; cursor:pointer; }
        .btn.tiktok{ background: linear-gradient(135deg,var(--tiktok-pink),var(--tiktok-blue)); box-shadow:0 8px 24px rgba(254,44,85,0.12); }

        /* Features & Packages */
        .features{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:18px; margin-bottom:28px; }
        .feature-card{ background:rgba(255,255,255,0.04); padding:18px; border-radius:14px; text-align:center; border:1px solid rgba(255,255,255,0.06); transition:0.25s; }
        .feature-card:hover{ transform:translateY(-8px); box-shadow:0 18px 40px rgba(0,0,0,0.35); }

        .packages-section{ margin:30px 0; }
        .section-title{ text-align:center; font-size:1.8rem; margin-bottom:18px; display:inline-block; background:linear-gradient(90deg,var(--primary),var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; padding:0 10px; }

        .package-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; margin-bottom:20px; }
        .package-card{ background:rgba(255,255,255,0.03); padding:16px; border-radius:12px; text-align:center; border:1px solid rgba(255,255,255,0.06); transition:0.25s; }
        .package-card:hover{ transform:translateY(-8px); box-shadow:0 18px 40px rgba(0,0,0,0.35); }
        .package-amount{ font-size:2.4rem; font-weight:900; margin-bottom:6px; background:linear-gradient(90deg,var(--primary),var(--accent)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
        .package-price{ font-size:1.6rem; font-weight:800; margin-bottom:12px; }

        /* Contact */
        .contact-section{ background:rgba(255,255,255,0.02); padding:18px; border-radius:12px; margin-top:20px; border:1px solid rgba(255,255,255,0.03); }
        .contact-bar{ display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px; }

        .contact-item{ display:flex; gap:12px; align-items:center; padding:12px; border-radius:12px; text-decoration:none; color:inherit; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); }
        .contact-item:hover{ transform:translateY(-6px); box-shadow:0 12px 30px rgba(0,0,0,0.25); }

        .contact-icon{ width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:linear-gradient(90deg,var(--primary),var(--accent)); font-size:20px; }

        .social-cards{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:12px; }

        /* Pages */
        .page{ display:none; animation:fadeIn .35s ease; }
        .page.active{ display:block; }

        @keyframes fadeIn{ from{opacity:0} to{opacity:1} }

        .payment-page{ max-width:680px; margin:18px auto; background:rgba(255,255,255,0.02); padding:18px; border-radius:12px; border:1px solid rgba(255,255,255,0.04); }
        .form-group{ margin-bottom:12px; }
        .form-control{ width:100%; padding:12px; border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.06); color:var(--light); }
        .form-control::placeholder{ color:rgba(255,255,255,0.5); }

        .order-item{ background:rgba(255,255,255,0.02); padding:14px; border-radius:12px; margin-bottom:12px; border:1px solid rgba(255,255,255,0.03); }
        .status-pending{ background:rgba(255,199,95,0.14); color: #FFC75F; padding:6px 12px; border-radius:20px; }
        .status-completed{ background:rgba(0,201,167,0.12); color: #00C9A7; padding:6px 12px; border-radius:20px; }

        /* Loader overlay */
        #loader{ display:none; position:fixed; inset:0; background:rgba(10,10,20,0.6); z-index:9999; align-items:center; justify-content:center; color:#fff; font-size:1.25rem; }

        /* Responsive */
        @media(max-width:768px){
            header{ flex-direction:column; gap:12px; align-items:flex-start; }
            .menu-toggle{ display:block; }
            nav ul{ display:none; flex-direction:column; gap:8px; width:100%; margin-top:8px; }
            nav ul.show{ display:flex; }
            nav a{ padding:10px; width:100%; }
        }
    </style>
</head>
<body>
    <div id="loader"><i class="fas fa-spinner fa-spin" style="margin-left:8px;"></i> جاري المعالجة...</div>

    <div class="container">
        <!-- HOME PAGE -->
        <div id="homePage" class="page active">
            <header>
                <div class="logo-container">
                    <img src="1.png" alt="Roma&Knzy Stor" />
                    <div>
                        <div class="logo-text">Roma & Knzy Store</div>
                        <div style="font-size:12px; opacity:0.7;">خدمات شحن متابعين وإنعاش الحسابات</div>
                    </div>
                </div>

                <nav>
                    <button class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
                    <ul id="mainNav">
                        <li><a href="#" onclick="showPage('homePage')">الرئيسية</a></li>
                        <li><a href="#" onclick="showPage('ordersPage')">طلباتي</a></li>
                        <li><a href="#" onclick="logout()" style="color:#ffb3d1; font-weight:700;">تسجيل الخروج</a></li>
                    </ul>
                </nav>
            </header>

            <div class="service-tabs">
                <div class="service-tab active" id="tabInstagram" onclick="showService('instagram')"><i class="fab fa-instagram"></i> خدمات الإنستجرام</div>
                <div class="service-tab tiktok" id="tabTiktok" onclick="showService('tiktok')"><i class="fab fa-tiktok"></i> خدمات تيك توك</div>
            </div>

            <!-- Instagram Service -->
            <div id="instagramService" class="service-content">
                <section class="hero">
                    <h1>مصدرك الموثوق لزيادة المتابعين</h1>
                    <p>احصل على متابعين إنستجرام بأفضل الأسعار وبأمان تام — لا تحتاج لكلمة المرور.</p>
                    <button class="btn" onclick="document.getElementById('packages').scrollIntoView({behavior:'smooth'})"><i class="fas fa-shopping-cart"></i> ابدأ الآن</button>
                </section>

                <section class="features">
                    <div class="feature-card">
                        <i class="fas fa-shield-alt" style="font-size:28px; margin-bottom:10px;"></i>
                        <h3>ضمان الجودة</h3>
                        <p>استرجاع الأموال إذا لم تصل الخدمة حسب الاتفاق.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-bolt" style="font-size:28px; margin-bottom:10px;"></i>
                        <h3>تسليم سريع</h3>
                        <p>التسليم يبدأ فور تأكيد الدفع — عادة خلال 10-20 دقيقة.</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-lock" style="font-size:28px; margin-bottom:10px;"></i>
                        <h3>آمن تماماً</h3>
                        <p>الخدمة لا تطلب كلمة المرور — الأمان أولويتنا.</p>
                    </div>
                </section>

                <section id="packages" class="packages-section">
                    <h2 class="section-title">الباقات المتاحة</h2>

                    <div class="package-grid">
                        <!-- sample packages -->
                        <div class="package-card">
                            <div class="package-amount">50</div>
                            <div style="opacity:0.8;">متابع إنستجرام</div>
                            <div class="package-price">15 جنيه</div>
                            <button class="btn" onclick="selectPackage(50,15,'instagram','متابعين')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                        <div class="package-card">
                            <div class="package-amount">100</div>
                            <div style="opacity:0.8;">متابع إنستجرام</div>
                            <div class="package-price">25 جنيه</div>
                            <button class="btn" onclick="selectPackage(100,25,'instagram','متابعين')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                        <div class="package-card">
                            <div class="package-amount">300</div>
                            <div style="opacity:0.8;">متابع إنستجرام</div>
                            <div class="package-price">60 جنيه</div>
                            <button class="btn" onclick="selectPackage(300,60,'instagram','متابعين')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                        <div class="package-card">
                            <div class="package-amount">1000</div>
                            <div style="opacity:0.8;">متابع إنستجرام</div>
                            <div class="package-price">150 جنيه</div>
                            <button class="btn" onclick="selectPackage(1000,150,'instagram','متابعين')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                    </div>
                </section>
            </div>

            <!-- TikTok Service -->
            <div id="tiktokService" class="service-content" style="display:none;">
                <section class="hero">
                    <h1 style="background:linear-gradient(90deg,var(--tiktok-pink),var(--tiktok-blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">خدمات تيك توك الاحترافية</h1>
                    <p>لايكات، مشاهدات، حفظ ومشاركة بجودة وسرعة.</p>
                    <button class="btn tiktok" onclick="document.getElementById('tiktok-packages').scrollIntoView({behavior:'smooth'})"><i class="fab fa-tiktok"></i> ابدأ الآن</button>
                </section>

                <section class="packages-section" id="tiktok-packages">
                    <h2 class="section-title" style="background:linear-gradient(90deg,var(--tiktok-pink),var(--tiktok-blue)); -webkit-background-clip:text; -webkit-text-fill-color:transparent;">باقات تيك توك</h2>
                    <div class="package-grid">
                        <div class="package-card tiktok">
                            <div class="package-amount">60</div>
                            <div style="opacity:0.8;">لايك تيك توك</div>
                            <div class="package-price">5 جنيه</div>
                            <button class="btn tiktok" onclick="selectPackage(60,5,'tiktok','لايكات')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                        <div class="package-card tiktok">
                            <div class="package-amount">240</div>
                            <div style="opacity:0.8;">لايك تيك توك</div>
                            <div class="package-price">20 جنيه</div>
                            <button class="btn tiktok" onclick="selectPackage(240,20,'tiktok','لايكات')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                        <div class="package-card tiktok">
                            <div class="package-amount">300</div>
                            <div style="opacity:0.8;">مشاهدة تيك توك</div>
                            <div class="package-price">30 جنيه</div>
                            <button class="btn tiktok" onclick="selectPackage(300,30,'tiktok','مشاهدات')"><i class="fas fa-shopping-cart"></i> اختر الباقة</button>
                        </div>
                    </div>
                </section>
            </div>

            <section class="contact-section">
                <div class="contact-bar">
                    <a class="contact-item" href="https://wa.me/+201122223344" target="_blank">
                        <div class="contact-icon"><i class="fab fa-whatsapp"></i></div>
                        <div>
                            <div style="font-weight:800;">واتساب للطلبات</div>
                            <div style="opacity:0.8;">01122223344</div>
                        </div>
                    </a>
                    <a class="contact-item" href="https://wa.me/+201141346727" target="_blank">
                        <div class="contact-icon"><i class="fab fa-whatsapp"></i></div>
                        <div>
                            <div style="font-weight:800;">واتساب للدعم</div>
                            <div style="opacity:0.8;">01141346727</div>
                        </div>
                    </a>
                    <a class="contact-item" href="https://www.instagram.com/xx.mariam_roma.x?igsh=Ymxxa2gzaDR3dTl4" target="_blank">
                        <div class="contact-icon"><i class="fab fa-instagram"></i></div>
                        <div>
                            <div style="font-weight:800;">إنستجرام روما</div>
                            <div style="opacity:0.8;">@xx.mariam_roma.x</div>
                        </div>
                    </a>
                    <a class="contact-item" href="https://www.instagram.com/x._.kenzyy_mohamedx?igsh=NzFyaTN4YXVmNmth" target="_blank">
                        <div class="contact-icon"><i class="fab fa-instagram"></i></div>
                        <div>
                            <div style="font-weight:800;">إنستجرام كنزي</div>
                            <div style="opacity:0.8;">@x._.kenzyy_mohamedx</div>
                        </div>
                    </a>
                </div>

                <div class="social-cards">
                    <a class="social-card" href="#"><i class="fab fa-telegram fa-2x"></i><div>قناة تيليجرام</div></a>
                    <a class="social-card" href="#"><i class="fab fa-facebook fa-2x"></i><div>صفحة فيسبوك</div></a>
                </div>
            </section>
        </div>

        <!-- ORDERS PAGE -->
        <div id="ordersPage" class="page">
            <header style="margin-bottom:12px;">
                <div class="logo-container">
                    <img src="1.png" alt="logo" />
                    <div class="logo-text">طلباتي</div>
                </div>
                <nav>
                    <ul id="ordersNav">
                        <li><a href="#" onclick="showPage('homePage')">الرئيسية</a></li>
                        <li><a href="#" onclick="showPage('ordersPage')">طلباتي</a></li>
                    </ul>
                </nav>
            </header>

            <h2 class="section-title">طلباتي</h2>
            <div id="ordersList">
                <!-- سيتم ملؤها بواسطة JS -->
            </div>
        </div>

        <!-- PAYMENT PAGE -->
        <div id="paymentPage" class="page">
            <header style="margin-bottom:12px;">
                <div class="logo-container">
                    <img src="1.png" alt="Roma&Knzy Stor" />
                    <div>
                        <div class="logo-text">إتمام الطلب</div>
                        <div style="font-size:12px; opacity:0.7;">ادخل بيانات الطلب والدفع</div>
                    </div>
                </div>
            </header>

            <div class="payment-page">
                <h2 style="text-align:center; margin-bottom:12px;">إتمام الطلب</h2>

                <div style="background:rgba(255,255,255,0.02); padding:12px; border-radius:10px; margin-bottom:12px;">
                    <h3 style="margin-bottom:6px;">باقة مختارة</h3>
                    <p id="selectedPackageInfo" style="opacity:0.9;">باقة 100 متابع - 25 جنيه</p>
                </div>

                <div style="background:rgba(255,255,255,0.02); padding:12px; border-radius:10px; margin-bottom:12px;">
                    <h3>طريقة الدفع</h3>
                    <div style="display:flex; gap:12px; align-items:center; margin-top:8px;">
                        <i class="fas fa-mobile-alt" style="font-size:26px;"></i>
                        <div>
                            <div style="font-weight:800;">الدفع عبر فودافون كاش</div>
                            <div style="font-size:1.1rem; font-weight:900; color:var(--accent);">01031090116</div>
                        </div>
                    </div>
                    <p style="opacity:0.8; margin-top:8px;">أرسل المبلغ ثم أرفق صورة إيصال الدفع.</p>
                </div>

                <div class="form-group" id="usernameGroup">
                    <label style="font-weight:800; display:block; margin-bottom:6px;" id="usernameLabel">اسم المستخدم في إنستجرام</label>
                    <input id="username" class="form-control" placeholder="اسم المستخدم بدون @" />
                </div>

                <div class="form-group" id="videoLinkGroup" style="display:none;">
                    <label style="font-weight:800; display:block; margin-bottom:6px;" id="videoLinkLabel">رابط الفيديو في تيك توك</label>
                    <input id="videoLink" class="form-control" placeholder="https://www.tiktok.com/@username/video/123..." />
                </div>

                <div class="form-group">
                    <label style="font-weight:800; display:block; margin-bottom:6px;">رقم الهاتف</label>
                    <input id="phone" class="form-control" placeholder="مثال: 010xxxxxxxx" />
                </div>

                <div class="form-group">
                    <label style="font-weight:800; display:block; margin-bottom:6px;">صورة إيصال الدفع</label>
                    <input id="receipt" type="file" class="form-control" accept="image/*" />
                </div>

                <button class="btn" style="width:100%;" onclick="submitOrder()">تأكيد الطلب</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        /***** CONFIGURE FIREBASE (Use your existing project's config) *****/
        const firebaseConfig = {
            apiKey: "AIzaSyA-Pi_g3EUeSgOeVii_OqodpDguMMyPknY",
            authDomain: "romalshop.firebaseapp.com",
            projectId: "romalshop",
            storageBucket: "romalshop.firebasestorage.app",
            messagingSenderId: "830369715807",
            appId: "1:830369715807:web:fbfde9ded9daac6eb46dea"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Default selected package
        let selectedPackage = { amount: 100, price: 25, service: 'instagram', type: 'متابعين' };

        // Show page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');

            // hide mobile menus if any
            document.querySelectorAll('nav ul').forEach(u => u.classList.remove('show'));

            if (pageId === 'ordersPage') {
                // use real-time listener
                loadOrdersRealtime();
            }
        }

        // Toggle mobile menu
        function toggleMenu() {
            document.querySelectorAll('nav ul').forEach(u => u.classList.toggle('show'));
        }

        // Toggle service tabs
        function showService(service) {
            document.querySelectorAll('.service-tab').forEach(t => t.classList.remove('active'));
            if (service === 'instagram') {
                document.getElementById('tabInstagram').classList.add('active');
                document.getElementById('instagramService').style.display = 'block';
                document.getElementById('tiktokService').style.display = 'none';
            } else {
                document.getElementById('tabTiktok').classList.add('active');
                document.getElementById('instagramService').style.display = 'none';
                document.getElementById('tiktokService').style.display = 'block';
            }
        }

        // Select package -> open payment page and update fields
        function selectPackage(amount, price, service, type) {
            selectedPackage = { amount, price, service, type };

            const serviceText = service === 'instagram' ? 'إنستجرام' : 'تيك توك';
            const typeText = type === 'متابعين' ? 'متابع' : type;

            document.getElementById('selectedPackageInfo').textContent = `باقة ${amount} ${typeText} ${serviceText} - ${price} جنيه`;

            // show/hide username/video fields
            const usernameGroup = document.getElementById('usernameGroup');
            const videoLinkGroup = document.getElementById('videoLinkGroup');

            if (service === 'instagram') {
                usernameGroup.style.display = 'block';
                videoLinkGroup.style.display = 'none';
                document.getElementById('usernameLabel').textContent = 'اسم المستخدم في إنستجرام';
                document.getElementById('username').placeholder = 'اسم المستخدم بدون @';
            } else {
                usernameGroup.style.display = 'none';
                videoLinkGroup.style.display = 'block';
                document.getElementById('videoLinkLabel').textContent = 'رابط الفيديو في تيك توك';
                document.getElementById('videoLink').placeholder = 'https://www.tiktok.com/@username/video/123...';
            }

            showPage('paymentPage');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Helper: show loader
        function showLoader(msg = 'جاري المعالجة...') {
            const loader = document.getElementById('loader');
            loader.style.display = 'flex';
            loader.innerHTML = `<i class="fas fa-spinner fa-spin" style="margin-left:8px;"></i> ${msg}`;
        }
        function hideLoader() { document.getElementById('loader').style.display = 'none'; }

        // Validate TikTok URL (basic)
        function isValidTikTokUrl(url) {
            try {
                const u = new URL(url);
                return u.hostname.includes('tiktok.com') || u.hostname.includes('vm.tiktok.com');
            } catch (e) { return false; }
        }

        // Submit order: uploads receipt to Storage then stores order in Firestore
        async function submitOrder() {
            const phone = document.getElementById('phone').value.trim();
            const receiptFile = document.getElementById('receipt').files[0];
            let userInput = '';

            if (selectedPackage.service === 'instagram') {
                userInput = document.getElementById('username').value.trim();
                if (!userInput) {
                    return Swal.fire({ icon:'warning', title:'اسم المستخدم مطلوب', text:'الرجاء إدخال اسم المستخدم في إنستجرام' });
                }
            } else {
                userInput = document.getElementById('videoLink').value.trim();
                if (!userInput || !isValidTikTokUrl(userInput)) {
                    return Swal.fire({ icon:'warning', title:'رابط تيك توك غير صالح', text:'ادخل رابط فيديو تيك توك صحيح.' });
                }
            }

            // phone validation (Egyptian numbers)
            const phoneRegex = /^(01)(0|1|2|5)[0-9]{8}$/;
            if (!phoneRegex.test(phone)) {
                return Swal.fire({ icon:'warning', title:'رقم الهاتف غير صالح', text:'الرجاء إدخال رقم مصري صحيح مثل 010xxxxxxxx' });
            }

            if (!receiptFile) {
                return Swal.fire({ icon:'warning', title:'صورة الإيصال مطلوبة', text:'الرجاء إرفاق صورة إيصال الدفع' });
            }

            try {
                showLoader('جاري رفع الإيصال...');

                // upload file
                const fileRef = storage.ref().child(`receipts/${Date.now()}_${receiptFile.name}`);
                const uploadTask = fileRef.put(receiptFile);

                // wait for upload and get URL
                await new Promise((resolve, reject) => {
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            // you can use snapshot to show upload progress percentage
                        },
                        (err) => reject(err),
                        () => resolve()
                    );
                });

                const receiptURL = await fileRef.getDownloadURL();

                // create order object
                const newOrder = {
                    package: selectedPackage,
                    userInput,
                    phone,
                    receiptURL,
                    status: 'قيد المراجعة',
                    date: new Date().toLocaleDateString('ar-EG'),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };

                // save to Firestore
                await db.collection('orders').add(newOrder);

                hideLoader();
                Swal.fire({ icon:'success', title:'تم إرسال طلبك', text:'تم إرسال الطلب وسيتم مراجعته من الأدمن قريبا.' });

                // reset form
                resetPaymentForm();
                showPage('ordersPage');
            } catch (error) {
                console.error('submitOrder error', error);
                hideLoader();
                Swal.fire({ icon:'error', title:'فشل الإرسال', text:'حدث خطأ أثناء الإرسال. تحقق من اتصال الإنترنت وحاول مرة أخرى.' });
            }
        }

        function resetPaymentForm() {
            document.getElementById('username').value = '';
            document.getElementById('videoLink').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('receipt').value = '';
        }

        // Load orders once (non-realtime) - fallback
        async function loadOrdersOnce() {
            const ordersList = document.getElementById('ordersList');
            showLoader('جاري تحميل الطلبات...');
            try {
                const snapshot = await db.collection('orders').orderBy('timestamp','desc').get();
                hideLoader();
                if (snapshot.empty) {
                    ordersList.innerHTML = `<div style="text-align:center; padding:40px;">لا توجد طلبات حالياً</div>`;
                    return;
                }
                let html = '';
                snapshot.forEach(doc => {
                    const order = doc.data();
                    const statusClass = order.status === 'تم الإرسال' ? 'status-completed' : 'status-pending';
                    const serviceText = order.package.service === 'instagram' ? 'إنستجرام' : 'تيك توك';
                    html += `
                        <div class="order-item">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                <div>
                                    <strong>طلب #${doc.id.slice(-6)}</strong>
                                    <p style="opacity:0.8;">${order.package.amount} ${order.package.type} ${serviceText} - ${order.package.price} جنيه</p>
                                </div>
                                <span class="${statusClass}">${order.status}</span>
                            </div>
                            <p><strong>${order.package.service === 'instagram' ? 'اسم المستخدم:' : 'رابط الفيديو:'}</strong> ${order.userInput}</p>
                            <p><strong>رقم الهاتف:</strong> ${order.phone}</p>
                            <p><strong>تاريخ الطلب:</strong> ${order.date || ''}</p>
                            <p><strong>الإيصال:</strong> <a href="${order.receiptURL || '#'}" target="_blank" style="color:#ffd;">عرض</a></p>
                        </div>
                    `;
                });
                ordersList.innerHTML = html;
            } catch (e) {
                hideLoader();
                ordersList.innerHTML = '<p style="text-align:center; color:#ff8080;">حدث خطأ أثناء تحميل الطلبات</p>';
            }
        }

        // Realtime listener to auto-update orders (useful if admin updates statuses)
        let unsubscribeOrders = null;
        function loadOrdersRealtime() {
            const ordersList = document.getElementById('ordersList');
            if (unsubscribeOrders) {
                // already listening
                return;
            }
            showLoader('جاري تحميل الطلبات...');
            unsubscribeOrders = db.collection('orders').orderBy('timestamp','desc')
                .onSnapshot(snapshot => {
                    hideLoader();
                    if (snapshot.empty) {
                        ordersList.innerHTML = `<div style="text-align:center; padding:40px;">لا توجد طلبات حالياً</div>`;
                        return;
                    }
                    let html = '';
                    snapshot.forEach(doc => {
                        const order = doc.data();
                        const statusClass = order.status === 'تم الإرسال' ? 'status-completed' : 'status-pending';
                        const serviceText = order.package.service === 'instagram' ? 'إنستجرام' : 'تيك توك';
                        html += `
                            <div class="order-item">
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                                    <div>
                                        <strong>طلب #${doc.id.slice(-6)}</strong>
                                        <p style="opacity:0.8;">${order.package.amount} ${order.package.type} ${serviceText} - ${order.package.price} جنيه</p>
                                    </div>
                                    <span class="${statusClass}">${order.status}</span>
                                </div>
                                <p><strong>${order.package.service === 'instagram' ? 'اسم المستخدم:' : 'رابط الفيديو:'}</strong> ${order.userInput}</p>
                                <p><strong>رقم الهاتف:</strong> ${order.phone}</p>
                                <p><strong>تاريخ الطلب:</strong> ${order.date || ''}</p>
                                <p><strong>الإيصال:</strong> <a href="${order.receiptURL || '#'}" target="_blank" style="color:#ffd;">عرض</a></p>
                            </div>
                        `;
                    });
                    ordersList.innerHTML = html;
                }, err => {
                    console.error('Realtime orders error', err);
                    hideLoader();
                    ordersList.innerHTML = '<p style="text-align:center; color:#ff8080;">لا يمكن تحميل الطلبات الآن</p>';
                });
        }

        // Basic auth check (you said admin system exists server-side). Keep local guard but rely on admin auth on server.
        document.addEventListener('DOMContentLoaded', () => {
            // Small console message
            console.log('Roma & Knzy Store - Frontend loaded.');
            // If not logged in client-side redirect to login (your login.html must set localStorage.loggedIn)
            if (!localStorage.getItem('loggedIn')) {
                window.location.href = 'login.html';
            }
        });

        // Logout
        function logout() {
            localStorage.removeItem('loggedIn');
            window.location.href = 'login.html';
        }

        // If user navigates back to home, stop realtime listener to save resources
        // (optional, but we keep listener active only on orders page)
        window.addEventListener('hashchange', () => {
            // not using hash navigation here
        });

        // Optional: when user leaves ordersPage, unsubscribe
        // (we unsubscribe when navigating back to home)
        function stopOrdersListener() {
            if (unsubscribeOrders) {
                unsubscribeOrders();
                unsubscribeOrders = null;
            }
        }

        // Enhance: When showing home page, stop realtime orders listening
        const originalShowPage = showPage;
        showPage = function(pageId) {
            // stop listener if leaving orders page
            if (pageId !== 'ordersPage') stopOrdersListener();
            originalShowPage(pageId);
        }
    </script>
</body>
</html>
