<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roma&knzy stor - منصة متابعات إنستجرام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* كل الستايلات السابقة */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --secondary: #F8BBD9;
            --secondary-dark: #F48FB1;
            --accent: #FF80AB;
            --light: #FCE4EC;
            --dark: #1A1A2E;
            --success: #00C9A7;
            --warning: #FFC75F;
            --danger: #FF8066;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-dark: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%);
        }

        body {
            background: linear-gradient(135deg, var(--dark) 0%, #2D1B3E 100%);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* باقي الستايلات */
        /* ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- الصفحة الرئيسية -->
        <div id="homePage" class="page active">
            <header>
                <div class="logo-container">
                    <div class="logo floating">
                        <img src="1.png" alt="Roma&knzy stor Logo">
                    </div>
                    <div class="logo-text">
                        Roma&knzy stor
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" onclick="showPage('homePage')">الرئيسية</a></li>
                        <li><a href="#" onclick="showPage('ordersPage')">طلباتي</a></li>
                        <li id="authNavItem">
                            <a href="#" onclick="showPage('loginPage')">تسجيل الدخول</a>
                        </li>
                    </ul>
                </nav>
                <div class="user-menu" id="userMenu" style="display: none;">
                    <div class="user-avatar" id="userAvatar" onclick="showPage('profilePage')"></div>
                </div>
            </header>

            <!-- محتوى الصفحة الرئيسية -->
            <section class="hero">
                <h1>منصتك الموثوقة لزيادة المتابعين</h1>
                <p>احصل على متابعين حقيقيين ونشطين لحساب إنستجرامك بأفضل الأسعار</p>
                <a href="#packages" class="btn">
                    <i class="fas fa-shopping-cart"></i> ابدأ الآن
                </a>
            </section>

            <!-- باقي المحتوى -->
        </div>

        <!-- صفحة تسجيل الدخول -->
        <div id="loginPage" class="page">
            <header>
                <div class="logo-container">
                    <div class="logo">
                        <img src="1.png" alt="Roma&knzy stor Logo">
                    </div>
                    <div class="logo-text">
                        Roma&knzy stor
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" onclick="showPage('homePage')">الرئيسية</a></li>
                        <li><a href="#" onclick="showPage('ordersPage')">طلباتي</a></li>
                        <li><a href="#" onclick="showPage('loginPage')">تسجيل الدخول</a></li>
                    </ul>
                </nav>
            </header>

            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px; font-size: 2rem;">تسجيل الدخول</h2>
                
                <div id="loginError" class="error-message" style="display: none;"></div>

                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-control" placeholder="البريد الإلكتروني">
                </div>

                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="كلمة المرور">
                </div>

                <button class="btn" style="width: 100%;" onclick="loginWithEmail()">تسجيل الدخول</button>

                <div class="divider">
                    <span>أو</span>
                </div>

                <div class="auth-methods">
                    <button class="btn btn-google" onclick="loginWithGoogle()">
                        <i class="fab fa-google"></i> تسجيل الدخول باستخدام جوجل
                    </button>
                </div>

                <div class="auth-switch">
                    <p>ليس لديك حساب؟ <a href="#" onclick="showPage('signupPage')">إنشاء حساب جديد</a></p>
                </div>
            </div>
        </div>

        <!-- صفحة إنشاء حساب -->
        <div id="signupPage" class="page">
            <!-- نفس الهيكل -->
        </div>

        <!-- صفحة الملف الشخصي -->
        <div id="profilePage" class="page">
            <!-- نفس الهيكل -->
        </div>

        <!-- صفحة الطلبات -->
        <div id="ordersPage" class="page">
            <!-- نفس الهيكل -->
        </div>

        <!-- صفحة الدفع -->
        <div id="paymentPage" class="page">
            <!-- نفس الهيكل -->
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // التهيئة الحقيقية لـ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA-Pi_g3EUeSgOeVii_OqodpDguMMyPknY",
            authDomain: "romalshop.firebaseapp.com",
            projectId: "romalshop",
            storageBucket: "romalshop.firebasestorage.app",
            messagingSenderId: "830369715807",
            appId: "1:830369715807:web:fbfde9ded9daac6eb46dea"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // حالة التطبيق
        let currentUser = null;
        let selectedPackage = null;

        // متابعة حالة المستخدم
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateAuthUI();
            
            if (user) {
                console.log('المستخدم مسجل:', user.email);
                // تحميل بيانات المستخدم الإضافية
                loadUserData(user.uid);
            } else {
                console.log('لا يوجد مستخدم مسجل');
            }
        });

        // تحديث واجهة المستخدم بناءً على حالة التسجيل
        function updateAuthUI() {
            const authNavItem = document.getElementById('authNavItem');
            const userMenu = document.getElementById('userMenu');

            if (currentUser) {
                authNavItem.innerHTML = '<a href="#" onclick="showPage(\'profilePage\')">ملفي</a>';
                userMenu.style.display = 'flex';
                
                // تحديث الصورة الرمزية
                const userAvatar = document.getElementById('userAvatar');
                if (currentUser.photoURL) {
                    userAvatar.innerHTML = `<img src="${currentUser.photoURL}" alt="صورة المستخدم">`;
                } else {
                    userAvatar.textContent = currentUser.displayName ? 
                        currentUser.displayName.charAt(0).toUpperCase() : 
                        currentUser.email.charAt(0).toUpperCase();
                }
            } else {
                authNavItem.innerHTML = '<a href="#" onclick="showPage(\'loginPage\')">تسجيل الدخول</a>';
                userMenu.style.display = 'none';
            }
        }

        // تسجيل الدخول بالبريد الإلكتروني
        async function loginWithEmail() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');

            if (!email || !password) {
                showError(errorElement, 'يرجى ملء جميع الحقول');
                return;
            }

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('تم تسجيل الدخول بنجاح:', userCredential.user.email);
                showPage('homePage');
                hideError(errorElement);
            } catch (error) {
                console.error('خطأ في تسجيل الدخول:', error);
                handleAuthError(error, errorElement);
            }
        }

        // تسجيل الدخول بجوجل
        async function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // حفظ بيانات المستخدم في Firestore
                await db.collection('users').doc(user.uid).set({
                    name: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL,
                    provider: 'google',
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                console.log('تم التسجيل بجوجل بنجاح:', user.email);
                showPage('homePage');
            } catch (error) {
                console.error('خطأ في التسجيل بجوجل:', error);
                document.getElementById('loginError').textContent = 'حدث خطأ أثناء التسجيل بجوجل';
                document.getElementById('loginError').style.display = 'block';
            }
        }

        // إنشاء حساب جديد
        async function signupWithEmail() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorElement = document.getElementById('signupError');

            // التحقق من البيانات
            if (!name || !email || !password || !confirmPassword) {
                showError(errorElement, 'يرجى ملء جميع الحقول');
                return;
            }

            if (password !== confirmPassword) {
                showError(errorElement, 'كلمات المرور غير متطابقة');
                return;
            }

            if (password.length < 6) {
                showError(errorElement, 'كلمة المرور يجب أن تكون 6 أحرف على الأقل');
                return;
            }

            try {
                // إنشاء المستخدم في Firebase Auth
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // تحديث الاسم المعروض
                await user.updateProfile({
                    displayName: name
                });

                // حفظ البيانات الإضافية في Firestore
                await db.collection('users').doc(user.uid).set({
                    name: name,
                    email: email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    plan: 'basic',
                    credits: 0
                });

                console.log('تم إنشاء الحساب بنجاح:', user.email);
                showPage('homePage');
                hideError(errorElement);
            } catch (error) {
                console.error('خطأ في إنشاء الحساب:', error);
                handleAuthError(error, errorElement);
            }
        }

        // تحميل بيانات المستخدم
        async function loadUserData(userId) {
            try {
                const userDoc = await db.collection('users').doc(userId).get();
                if (userDoc.exists) {
                    const userData = userDoc.data();
                    console.log('بيانات المستخدم:', userData);
                    // يمكنك استخدام هذه البيانات في التطبيق
                }
            } catch (error) {
                console.error('خطأ في تحميل بيانات المستخدم:', error);
            }
        }

        // إرسال طلب جديد
        async function submitOrder() {
            if (!currentUser) {
                alert('يرجى تسجيل الدخول أولاً');
                showPage('loginPage');
                return;
            }

            const username = document.getElementById('username').value;
            const phone = document.getElementById('phone').value;
            const receipt = document.getElementById('receipt').files[0];

            if (!username || !phone) {
                alert('يرجى ملء جميع الحقول المطلوبة');
                return;
            }

            try {
                const orderData = {
                    userId: currentUser.uid,
                    package: selectedPackage,
                    instagramUsername: username,
                    phone: phone,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    orderNumber: generateOrderNumber()
                };

                // حفظ الطلب في Firestore
                const orderRef = await db.collection('orders').add(orderData);
                
                console.log('تم إنشاء الطلب بنجاح:', orderRef.id);
                alert('تم تقديم طلبك بنجاح! رقم الطلب: ' + orderData.orderNumber);
                
                // إعادة تعيين النموذج
                resetPaymentForm();
                showPage('ordersPage');
            } catch (error) {
                console.error('خطأ في إرسال الطلب:', error);
                alert('حدث خطأ أثناء إرسال الطلب. يرجى المحاولة مرة أخرى.');
            }
        }

        // توليد رقم طلب عشوائي
        function generateOrderNumber() {
            return 'ORD-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5).toUpperCase();
        }

        // تحميل الطلبات
        async function loadOrders() {
            if (!currentUser) {
                document.getElementById('ordersList').innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <p>يرجى تسجيل الدخول لعرض الطلبات</p>
                        <button class="btn" onclick="showPage('loginPage')">تسجيل الدخول</button>
                    </div>
                `;
                return;
            }

            try {
                const ordersSnapshot = await db.collection('orders')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();

                const ordersList = document.getElementById('ordersList');
                
                if (ordersSnapshot.empty) {
                    ordersList.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <p>لا توجد طلبات حالياً</p>
                        </div>
                    `;
                    return;
                }

                let ordersHTML = '';
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    ordersHTML += `
                        <div class="order-item">
                            <h4>طلب #${order.orderNumber}</h4>
                            <p>الباقة: ${order.package.amount} متابع</p>
                            <p>الحساب: @${order.instagramUsername}</p>
                            <p>الحالة: ${getStatusBadge(order.status)}</p>
                            <p>التاريخ: ${new Date(order.createdAt?.toDate()).toLocaleDateString('ar-EG')}</p>
                        </div>
                    `;
                });

                ordersList.innerHTML = ordersHTML;
            } catch (error) {
                console.error('خطأ في تحميل الطلبات:', error);
                document.getElementById('ordersList').innerHTML = '<p>حدث خطأ في تحميل الطلبات</p>';
            }
        }

        // دوال مساعدة
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
        }

        function hideError(element) {
            element.style.display = 'none';
        }

        function handleAuthError(error, errorElement) {
            let message = 'حدث خطأ غير متوقع';
            
            switch (error.code) {
                case 'auth/email-already-in-use':
                    message = 'البريد الإلكتروني مستخدم بالفعل';
                    break;
                case 'auth/user-not-found':
                    message = 'البريد الإلكتروني غير مسجل';
                    break;
                case 'auth/wrong-password':
                    message = 'كلمة المرور غير صحيحة';
                    break;
                case 'auth/invalid-email':
                    message = 'البريد الإلكتروني غير صالح';
                    break;
                case 'auth/weak-password':
                    message = 'كلمة المرور ضعيفة';
                    break;
            }
            
            showError(errorElement, message);
        }

        function getStatusBadge(status) {
            const statuses = {
                'pending': '<span class="status-pending">قيد المراجعة</span>',
                'processing': '<span class="status-processing">قيد التنفيذ</span>',
                'completed': '<span class="status-completed">مكتمل</span>',
                'cancelled': '<span class="status-cancelled">ملغي</span>'
            };
            return statuses[status] || statuses.pending;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            if (pageId === 'ordersPage') {
                loadOrders();
            }
        }

        function selectPackage(amount, price) {
            selectedPackage = { amount, price };
            document.getElementById('selectedPackageInfo').textContent = 
                `باقة ${amount} متابع - ${price} جنيه`;
            showPage('paymentPage');
        }

        function resetPaymentForm() {
            document.getElementById('username').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('receipt').value = '';
        }

        // تسجيل الخروج
        function logout() {
            auth.signOut().then(() => {
                console.log('تم تسجيل الخروج');
                showPage('homePage');
            });
        }

        // التهيئة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            console.log('تم تحميل منصة Roma&knzy stor بنجاح');
        });
    </script>
</body>
</html>
